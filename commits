import static org.junit.jupiter.api.Assertions.*;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

public class LoanV2MessageTransformerTest {

    private LoanV2MessageTransformer transformer;

    @BeforeEach
    public void setUp() {
        transformer = new LoanV2MessageTransformer();
    }

    @Test
    public void testProcess_TranSuffNull() throws Exception {
        LoanV250DPosition loanV250DPosition = new LoanV250DPosition();
        loanV250DPosition.setTranSuff(null);
        loanV250DPosition.setLoanMsgKey("LMK123");
        loanV250DPosition.setAreald("AR123");
        loanV250DPosition.setTranNum("TN123");
        loanV250DPosition.setCusipNum("C123");
        loanV250DPosition.setRosid("R123");
        loanV250DPosition.setStatusFlg("S123");
        loanV250DPosition.setBusinessLine("BL123");
        loanV250DPosition.setBrokerNum("B123");
        loanV250DPosition.setClearAgentNum("CA123");
        loanV250DPosition.setSettlementCode("SC123");
        loanV250DPosition.setCollateralCode("CC123");
        loanV250DPosition.setOriginatorNum("O123");
        loanV250DPosition.setFinanceFlag("F123");
        loanV250DPosition.setLotId("L123");
        loanV250DPosition.setRemarks("Remarks");
        loanV250DPosition.setCurrUtiNumber("CUN123");
        loanV250DPosition.setParentUtiNumber("PUN123");
        loanV250DPosition.setOriginalUtiNumber("OUN123");
        loanV250DPosition.setEqlTradeld("ET123");
        loanV250DPosition.setMicCode("M123");
        loanV250DPosition.setLoanType("LT123");
        loanV250DPosition.setRebateAccrualAmount("RAA123");
        loanV250DPosition.setRebPremRate("RPR123");
        loanV250DPosition.setCollateralLevel("CL123");
        loanV250DPosition.setAllInRate("AIR123");
        loanV250DPosition.setTranDt("2023-01-01T00:00:00");
        loanV250DPosition.setAsofDt("2023-01-02");
        loanV250DPosition.setSettlementDate("2023-01-03");
        loanV250DPosition.setActualSettlementDate("2023-01-04");
        loanV250DPosition.setTradeDate("2023-01-05");
        loanV250DPosition.setOriginalResetDate("2023-01-06");
        loanV250DPosition.setExpectedReturnDate("2023-01-07");

        LoanV2MessageTransformer result = transformer.process(loanV250DPosition);

        assertNotNull(result);
        LoanOmni loanOmni = result.getLoanOmni();
        assertNotNull(loanOmni);
        assertEquals("LMK123", loanOmni.getLoanMsgKey());
        assertEquals("AR123", loanOmni.getIncorpCntryCd());
        assertEquals("TN123", loanOmni.getLoanNo());
        // Continue with other assertions as needed
    }

    @Test
    public void testProcess_TranSuffNotNull() throws Exception {
        LoanV250DPosition loanV250DPosition = new LoanV250DPosition();
        loanV250DPosition.setTranSuff("TS123");
        loanV250DPosition.setPrice("100.00");
        loanV250DPosition.setTranDt("2023-01-01T00:00:00");
        loanV250DPosition.setStatusFlg("S123");
        loanV250DPosition.setTradeDate("2023-01-02");
        loanV250DPosition.setOriginatorNum("O123");
        loanV250DPosition.setCloseDate("2023-01-03");
        loanV250DPosition.setCurrUtiNumber("CUN123");
        loanV250DPosition.setParentUtiNumber("PUN123");
        loanV250DPosition.setOriginalUtiNumber("OUN123");
        loanV250DPosition.setMicCode("M123");
        loanV250DPosition.setAcctNum("A123");
        loanV250DPosition.setDeliveryAmount("DA123");
        loanV250DPosition.setLastModDateTime("2023-01-04");
        loanV250DPosition.setQuantity("Q123");
        loanV250DPosition.setLoanMsgKey("LMK123");

        LoanV2MessageTransformer result = transformer.process(loanV250DPosition);

        assertNotNull(result);
        LoanLot loanLot = result.getLoanLot();
        assertNotNull(loanLot);
        assertEquals("TS123", loanLot.getAllocSeqNo());
        assertEquals("100.00", loanLot.getContractPrice());
        assertEquals("2023-01-01T00:00:00", loanLot.getTransactionDt());
        // Continue with other assertions as needed

        LoanFund loanFund = result.getLoanFund();
        assertNotNull(loanFund);
        assertEquals("A123", loanFund.getFund());
        assertEquals("DA123", loanFund.getSettledAmt());
        // Continue with other assertions as needed
    }



_______________

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class LoanService {

    @Autowired
    private NamedParameterJdbcTemplate namedParameterJdbcTemplate;

    public boolean updateLoanV250DMessageProcessStatus(List<String> loanMsgKeys, Long eventId) throws Exception {
        MapSqlParameterSource parameters = new MapSqlParameterSource();
        parameters.addValue("eventId", eventId);
        parameters.addValue("loanMsgKeys", loanMsgKeys);

        String updateQry = "UPDATE IAL_SLB_LOAN_V2_SOD_TRANSFORM SET STATUS = 'SUCCESS', LASTMODDATETIME = CURRENT_TIMESTAMP WHERE EVENT_ID = :eventId AND LOAN_MSG_KEY IN (:loanMsgKeys)";

        int result = namedParameterJdbcTemplate.update(updateQry, parameters);

        return true;
    }
}


